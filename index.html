<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ETA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"-->
  <script type="text/javascript" src="elm.js"></script>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <script type="text/javascript">

    const app = Elm.Main.init({
        flags: rememberedBytes()
    });

    /* Fetch back generated bytes from the local storage */
    function rememberedBytes() {
      const bytes = localStorage.getItem("bytes");
      return bytes ? bytes.split(",").map(x => parseInt(x,10)) : null;
    }

    /* Generate high entropy random bytes using the Web Crypto API and
    remember them so that they are preserved between redirections. This
    allows to protect for XSS & authorization code attacks */
    app.ports.genRandomBytes.subscribe(n => {
      const buffer = new Uint8Array(n);
      crypto.getRandomValues(buffer);
      const bytes = Array.from(buffer);
      localStorage.setItem("bytes", bytes);
      app.ports.randomBytes.send(bytes);
    });
  </script>
</body>
</html>
